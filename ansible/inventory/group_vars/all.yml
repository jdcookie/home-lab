---
# Global variables for all hosts
# These can be overridden by environment variables - see .env.example

# Domain configuration
homelab_domain: "{{ lookup('pipe', 'grep ^HOMELAB_DOMAIN= ../../.env | cut -d= -f2') | default('lab.example.com', true) }}"
base_domain: "{{ lookup('pipe', 'grep ^BASE_DOMAIN= ../../.env | cut -d= -f2') | default('example.com', true) }}"

# Network configuration
homelab_network: "{{ lookup('pipe', 'grep ^NETWORK_CIDR= ../../.env | cut -d= -f2') | default('192.168.1.0/24', true) }}"
homelab_gateway: "{{ lookup('pipe', 'grep ^GATEWAY_IP= ../../.env | cut -d= -f2') | default('192.168.1.1', true) }}"
homelab_dns_primary: "{{ lookup('pipe', 'grep ^PIHOLE_IP= ../../.env | cut -d= -f2') | default('192.168.1.10', true) }}"
homelab_dns_secondary: "1.1.1.1"

# Timezone
timezone: "{{ lookup('pipe', 'grep ^TIMEZONE= ../../.env | cut -d= -f2') | default('America/New_York', true) }}"

# Docker configuration
docker_version: "latest"
docker_compose_version: "2.23.0"

# Service URLs (automatically built from homelab_domain)
pihole_url: "pihole.{{ homelab_domain }}"
caddy_url: "proxy.{{ homelab_domain }}"
jellyfin_url: "jellyfin.{{ homelab_domain }}"
n8n_url: "n8n.{{ homelab_domain }}"
portainer_url: "portainer.{{ homelab_domain }}"
uptime_url: "status.{{ homelab_domain }}"
netdata_url: "netdata.{{ homelab_domain }}"
truenas_url: "truenas.{{ homelab_domain }}"

# TrueNAS VM configuration
truenas_vm_id: 201
truenas_memory: 6144   # 6 GB max - reduced since pool is all-SSD (less ARC needed)
truenas_balloon: 3072  # Minimum RAM (3 GB) - can balloon up to truenas_memory
truenas_cores: 4
truenas_storage: local-lvm
truenas_boot_disk_size: 32
truenas_iso: "TrueNAS-SCALE-24.04.2.5.iso"
truenas_iso_url: "https://download.truenas.com/TrueNAS-SCALE-Dragonfish/24.04.2.5/TrueNAS-SCALE-24.04.2.5.iso"
truenas_ip: "{{ lookup('pipe', 'grep ^TRUENAS_IP= ../../.env | cut -d= -f2') | default('192.168.1.60', true) }}"
# NVMe drives for passthrough - set these after running: ls -la /dev/disk/by-id/ | grep nvme
truenas_nvme_drive_1: "{{ lookup('pipe', 'grep ^TRUENAS_NVME_1= ../../.env | cut -d= -f2') | default('', true) }}"
truenas_nvme_drive_2: "{{ lookup('pipe', 'grep ^TRUENAS_NVME_2= ../../.env | cut -d= -f2') | default('', true) }}"

# Netdata streaming API key (generate with: uuidgen)
# For production, move this to vault.yml
netdata_stream_api_key: "{{ lookup('pipe', 'grep ^NETDATA_STREAM_API_KEY= ../../.env | cut -d= -f2') | default('11111111-2222-3333-4444-555555555555', true) }}"

# NFS mounts from TrueNAS
truenas_pool_name: "{{ lookup('pipe', 'grep ^TRUENAS_POOL_NAME= ../../.env | cut -d= -f2') | default('tank', true) }}"
nfs_mounts:
  - src: "{{ hostvars['truenas']['ansible_host'] }}:/mnt/{{ truenas_pool_name }}/video"
    mount_point: /mnt/video
  # Immich photos (from ice-king pool)
  - src: "{{ hostvars['truenas']['ansible_host'] }}:/mnt/ice-king/photos"
    mount_point: /mnt/photos
  # Arr stack media mount (from ice-king pool)
  - src: "{{ hostvars['truenas']['ansible_host'] }}:/mnt/ice-king/video"
    mount_point: /mnt/media

# ===========================================
# IMMICH CONFIGURATION
# ===========================================

# Enable/disable Immich in Caddy/PiHole config
immich_enabled: true

# Immich service URL
immich_url: "immich.{{ homelab_domain }}"

# Immich storage paths (both use NFS mount to ice-king/photos)
immich_upload_path: "/mnt/photos/uploads"
immich_external_library: "/mnt/photos"

# Immich database password (from .env)
immich_db_password: "{{ lookup('pipe', 'grep ^IMMICH_DB_PASSWORD= ../../.env | cut -d= -f2') | default('changeme', true) }}"

# ===========================================
# ARR STACK CONFIGURATION
# ===========================================

# Enable/disable arr stack in Caddy config
arr_stack_enabled: true

# Arr stack service URLs
jellyseerr_url: "requests.{{ homelab_domain }}"
sonarr_url: "sonarr.{{ homelab_domain }}"
radarr_url: "radarr.{{ homelab_domain }}"
prowlarr_url: "prowlarr.{{ homelab_domain }}"
qbittorrent_url: "qbit.{{ homelab_domain }}"

# Arr stack paths
arr_media_path: "/mnt/media"

# User/Group IDs (should match NFS share permissions)
arr_puid: "1000"
arr_pgid: "1000"

# VPN configuration (secrets in vault.yml)
arr_vpn_provider: "mullvad"
arr_vpn_server_city: "Zurich"
arr_vpn_forward_port: ""

# Whether to create media directories (set false if using existing TrueNAS structure)
arr_create_media_dirs: false

# Paths
homelab_repo_path: "/opt/homelab"
compose_base_path: "/opt/homelab/compose"
backup_path: "/opt/backups"

# ===========================================
# GAME SERVER CONFIGURATION
# ===========================================

# Game server VM settings (defined in hosts.yml)
game_server_ip: "{{ lookup('pipe', 'grep ^GAME_SERVER_IP= ../../.env | cut -d= -f2') | default('192.168.1.51', true) }}"

# Satisfactory server configuration
satisfactory_puid: "1000"
satisfactory_pgid: "1000"
satisfactory_max_players: "4"
satisfactory_game_port: "7777"
satisfactory_query_port: "15777"
satisfactory_beacon_port: "15000"
satisfactory_autopause: "true"
satisfactory_autosave_interval: "300"
satisfactory_crash_report: "false"
satisfactory_skip_update: "false"
satisfactory_steam_beta: ""
satisfactory_data_path: "/mnt/games/satisfactory"

# Backup configuration
backup_retention_days: 30
backup_schedule: "0 2 * * *"  # Daily at 2 AM

# Let's Encrypt configuration
letsencrypt_email: "{{ lookup('pipe', 'grep ^ADMIN_EMAIL= ../../.env | cut -d= -f2') | default('admin@example.com', true) }}"

# DNS API credentials (for Let's Encrypt DNS challenge)
dns_api_key: "{{ lookup('pipe', 'grep ^DNS_API_KEY= ../../.env | cut -d= -f2') | default('', true) }}"
dns_secret_key: "{{ lookup('pipe', 'grep ^DNS_SECRET_KEY= ../../.env | cut -d= -f2') | default('', true) }}"

# ===========================================
# TAILSCALE CONFIGURATION
# ===========================================

# Enable/disable Tailscale subnet router
tailscale_enabled: true

# Tailscale auth key (from .env - NEVER commit the actual key)
tailscale_authkey: "{{ lookup('pipe', 'grep ^TAILSCALE_AUTHKEY= ../.env | cut -d= -f2') | default('', true) }}"

# Tailscale hostname for the subnet router
tailscale_hostname: "{{ lookup('pipe', 'grep ^TAILSCALE_HOSTNAME= ../.env | cut -d= -f2') | default('homelab-router', true) }}"

# Routes to advertise (your LAN subnet)
tailscale_advertise_routes: "{{ homelab_network }}"

# DNS settings - don't use Tailscale DNS (we have PiHole)
tailscale_accept_dns: false

# Don't accept routes from other Tailscale nodes
tailscale_accept_routes: false
